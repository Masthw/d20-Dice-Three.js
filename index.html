<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>D20 3D Dice</title>
    <style>
      body {
        margin: 0;
        overflow: hidden;
      }
      canvas {
        display: block;
      }
      #rollBtn {
        position: absolute;
        top: 20px;
        left: 20px;
        padding: 10px 20px;
        background: #333;
        color: white;
        border: none;
        font-size: 18px;
        cursor: pointer;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <button id="rollBtn">Rolar Dado</button>

    <script src="https://cdn.jsdelivr.net/npm/three@0.141.0/build/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.141.0/examples/js/loaders/GLTFLoader.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/gsap@3.12.2/dist/gsap.min.js"></script>

    <script>
      let scene = new THREE.Scene();
      scene.background = new THREE.Color("#3b3a39");
      let camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      );
      let renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setSize(window.innerWidth, window.innerHeight);
      document.body.appendChild(renderer.domElement);

      const ambientLight = new THREE.AmbientLight(0xffffff, 1);
      scene.add(ambientLight);

      const directionalLight1 = new THREE.DirectionalLight(0xffffff, 1.0);
      directionalLight1.position.set(5, 10, 5);
      scene.add(directionalLight1);

      const directionalLight2 = new THREE.DirectionalLight(0xffffff, 0.8);
      directionalLight2.position.set(-5, -10, -5);
      scene.add(directionalLight2);

      const pointLight = new THREE.PointLight(0xffffff, 1.0);
      pointLight.position.set(2, 2, 2);
      scene.add(pointLight);

      let dice;

      const loader = new THREE.GLTFLoader();
      loader.load("free-d20-baked-game-ready/source/D20.glb", function (gltf) {
        dice = gltf.scene;

        let box = new THREE.Box3().setFromObject(dice);
        let size = new THREE.Vector3();
        box.getSize(size);
        let center = new THREE.Vector3();
        box.getCenter(center);
        dice.position.sub(center);

        let maxDim = Math.max(size.x, size.y, size.z);
        let scaleFactor = 2 / maxDim;
        dice.scale.setScalar(scaleFactor);

        scene.add(dice);
        camera.position.set(0, 0, 5);
      });

      function animate() {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }
      animate();

      const numberRotations = {
        1: { x: 20.668, y: 17.312, z: 17.709 },
        2: { x: 18.148, y: 18.172, z: 17.709 },
        3: { x: 18.918, y: 20.872, z: 17.709 },
        4: { x: 18.628, y: 23.272, z: 17.709 },
        5: { x: 19.288, y: 24.412, z: 17.709 },
        6: { x: 18.438, y: 28.352, z: 17.709 },
        7: { x: 19.368, y: 32.242, z: 17.709 },
        8: { x: 10.231, y: 7.834, z: 6.455 },
        9: { x: 21.498, y: 31.262, z: 17.709 },
        10: { x: 24.578, y: 32.222, z: 17.709 },
        11: { x: 25.618, y: 29.162, z: 17.709 },
        12: { x: 24.628, y: 25.282, z: 17.709 },
        13: { x: 26.078, y: 23.582, z: 17.709 },
        14: { x: 24.408, y: 16.502, z: 17.709 },
        15: { x: 21.538, y: 15.602, z: 17.709 },
        16: { x: 18.188, y: 8.622, z: 17.709 },
        17: { x: 18.888, y: 13.832, z: 17.709 },
        18: { x: 18.808, y: 17.592, z: 17.709 },
        19: { x: 19.608, y: 21.302, z: 17.709 },
        20: { x: 17.528, y: 23.562, z: 17.709 },
      };

      document.getElementById("rollBtn").addEventListener("click", () => {
        if (!dice) return;

        const result = Math.floor(Math.random() * 20) + 1;
        const rot = numberRotations[result];

        const spin = rot
          ? {
              x: rot.x + Math.PI * 6,
              y: rot.y + Math.PI * 6,
              z: rot.z + Math.PI * 6,
            }
          : {
              x: dice.rotation.x + Math.PI * 2 * (Math.random() + 1),
              y: dice.rotation.y + Math.PI * 2 * (Math.random() + 1),
              z: dice.rotation.z + Math.PI * 2 * (Math.random() + 1),
            };

        gsap.to(dice.rotation, {
          duration: 3,
          ...spin,
          ease: "power4.out",
          onComplete: () => {
            console.log("NÃºmero rolado:", result);
            // luz de destaque
            const hl = new THREE.PointLight(0xffd700, 2, 5);
            hl.position.set(0, 0, 3);
            scene.add(hl);
            setTimeout(() => scene.remove(hl), 1500);
          },
        });
      });

      function highlightResult() {
        const highlight = new THREE.PointLight(0xffd700, 2, 5); // Luz dourada
        highlight.position.set(0, 0, 3);
        scene.add(highlight);

        // Remover a luz depois de 1.5 segundos
        setTimeout(() => {
          scene.remove(highlight);
        }, 1500);
      }

      let isDragging = false;
      let previousMousePosition = { x: 0, y: 0 };

      renderer.domElement.addEventListener("mousedown", (event) => {
        isDragging = true;
        previousMousePosition = { x: event.clientX, y: event.clientY };
      });

      renderer.domElement.addEventListener("mouseup", () => {
        isDragging = false;
      });

      renderer.domElement.addEventListener("mousemove", (event) => {
        if (!dice || !isDragging) return;

        const deltaMove = {
          x: event.clientX - previousMousePosition.x,
          y: event.clientY - previousMousePosition.y,
        };

        dice.rotation.y += deltaMove.x * 0.01;
        dice.rotation.x += deltaMove.y * 0.01;

        previousMousePosition = { x: event.clientX, y: event.clientY };
      });
    </script>
  </body>
</html>
